<html>

<head>
    <meta charset="UTF-8">
    <script src="http://cdnjs.cloudflare.com/ajax/libs/p5.js/0.4.6/p5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.4.16/addons/p5.sound.js"></script>

    <script>
        var x, y, cR, cG, cB, mX;
        var starX = [];
        var starY = [];
        var size = [];
        var firework;
        var analyzer = new p5.Amplitude();

        function preload() {
            firework = loadSound("firework.wav");
        }



        function setup() {
            createCanvas(700, 300);
            background(20);
            r = 0;
            c = 255;
            mx = 0;
            for (i = 0; i < 100; i++) {
                size[i] = random(0, 3);
                starX[i] = random(width);
                starY[i] = random(height / 4 * 2.5);
            };

        }

        function draw() {
            drawSphere();
            drawStar();
        }

        function drawSphere() {
            background(0, 0, 35, random(50));

            for (i = 0; i < 700; i++) {
                x = i;
                y = sqrt(abs(r * r - (((x - mX + width / 2) - 350) * ((x - mX + width / 2) - 350)))) * -1 + 300;
                noStroke();
                if ((x - mX + width / 2) < width / 2 - r || (x - mX + width / 2) > width / 2 + r) {
                    fill(0, 0, 35);
                } else {
                    fill(cR, cG, cB, analyzer.getLevel() * 5000 + 20);
                };
                ellipse(x, y, 2, 2);
            };
            r += random(7);

        }

        function drawStar() {
            for (i = 0; i < 100; i++) {
                starX[i] += random(-0.15, 0.15);
                starY[i] += random(-0.15, 0.15);
                fill(255, random(-20, 120));
                ellipse(starX[i], starY[i], size[i], size[i]);

            };
        }

        function mousePressed() {
            firework.play();
            mX = mouseX;
            r = 0;
            cR = random(100, 255);
            cG = random(100, 255);
            cB = random(100, 255);

        }
    </script>
</head>

</html>
